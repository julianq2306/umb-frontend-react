<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AplicaciÃ³n de lista de tareas desarrollada en React. Simple, rÃ¡pida y moderna.">
<title>Lista de Tareas</title>

<link rel="stylesheet" href="estilos.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YGPG57WCNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YGPG57WCNQ');
</script>

</head>
<body>

<div id="root"></div>

<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

<script>
const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
  ? 'http://localhost:8000/index.php'
  : 'https://umb-web-taller-w7mh.onrender.com/index.php';

function App() {
  const [tareas, setTareas] = React.useState([]);
  const [titulo, setTitulo] = React.useState('');
  const [query, setQuery] = React.useState('');
  const [editingId, setEditingId] = React.useState(null);
  const [editingTitle, setEditingTitle] = React.useState('');
  const [showSummary, setShowSummary] = React.useState(true);

  const cargar = React.useCallback(async () => {
    const r = await fetch(API_BASE);
    const d = await r.json();
    setTareas(d);
  }, []);

  React.useEffect(() => { cargar(); }, [cargar]);

  const crear = async (e) => {
    e.preventDefault();
    if (!titulo.trim()) return;
    await fetch(API_BASE, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ titulo }) });
    setTitulo('');
    cargar();
  };

  const toggle = async (t) => {
    await fetch(API_BASE, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id: t.id, completada: t.completada ? 0 : 1 }) });
    cargar();
  };

  const eliminar = async (id) => {
    await fetch(API_BASE, { method:'DELETE', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id }) });
    cargar();
  };

  const empezarEditar = (t) => {
    setEditingId(t.id);
    setEditingTitle(t.titulo);
  };

  const cancelarEditar = () => {
    setEditingId(null);
    setEditingTitle('');
  };

  const guardarEditar = async () => {
    if (!editingId) return;
    if (!editingTitle.trim()) return;
    await fetch(API_BASE, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id: editingId, titulo: editingTitle }) });
    cancelarEditar();
    cargar();
  };

  const filtered = tareas.filter(t => t.titulo.toLowerCase().includes(query.toLowerCase()));
  const total = tareas.length;
  const completed = tareas.filter(t => t.completada).length;
  const pct = total ? Math.round((completed/total)*100) : 0;

  const goTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });
  const focusNew = () => document.querySelector('.input')?.focus();
  const toggleSummaryView = () => setShowSummary(s => !s);

  return React.createElement('main', { className:'layout' },
    React.createElement('aside', { className:'sidebar' },
      React.createElement('button', { type:'button', className:'icon-btn', onClick: goTop }, 'ðŸ '),
      React.createElement('button', { type:'button', className:'icon-btn', onClick: focusNew }, 'ðŸ“'),
      React.createElement('button', { type:'button', className:'icon-btn', onClick: toggleSummaryView }, 'ðŸ“Š')
    ),
    React.createElement('section', { className:'main' },
      React.createElement('div', { className:'card' },
        React.createElement('div', { className:'card-header' },
          React.createElement('h1', { className:'title' }, 'Lista de Tareas'),
          React.createElement('input', { className:'search', placeholder:'Buscar', value: query, onChange: e => setQuery(e.target.value) })
        ),
        React.createElement('form', { className:'form', onSubmit: crear },
          React.createElement('input', { className:'input', value: titulo, onChange: e => setTitulo(e.target.value), placeholder:'Nueva tarea' }),
          React.createElement('button', { className:'btn', type:'submit' }, 'AÃ±adir')
        ),
        React.createElement('ul', { className:'list' },
          filtered.map(t =>
            React.createElement('li', { key: t.id, className:'row' },
              editingId === t.id
                ? React.createElement(React.Fragment, null,
                    React.createElement('input', { className:'edit-input', value: editingTitle, onChange: e => setEditingTitle(e.target.value) }),
                    React.createElement('button', { className:'btn', onClick: guardarEditar }, 'Guardar'),
                    React.createElement('button', { className:'del', onClick: cancelarEditar }, 'Cancelar')
                  )
                : React.createElement(React.Fragment, null,
                    React.createElement('button', { type:'button', className: t.completada ? 'status done' : 'status pending', onClick: () => toggle(t) },
                      t.completada ? 'âœ”' : 'â³'
                    ),
                    React.createElement('span', { className: t.completada ? 'text done' : 'text' }, t.titulo),
                    React.createElement('button', { type:'button', className:'edit', onClick: () => empezarEditar(t) }, 'âœ'),
                    React.createElement('button', { type:'button', className:'del', onClick: () => eliminar(t.id) }, 'ðŸ—‘')
                  )
            )
          )
        )
      )
    ),
    React.createElement('aside', { className:'right' },
      React.createElement('div', { className:'img-card' },
        React.createElement('img', { src:'https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=800', alt:'' })
      ),
      showSummary && React.createElement('div', { className:'summary-card' },
        React.createElement('h2', null, 'Progreso'),
        React.createElement('p', null, completed + ' / ' + total),
        React.createElement('div', { className:'progress' },
          React.createElement('div', { className:'bar', style:{ width: pct + '%' } })
        ),
        React.createElement('span', { className:'pct' }, pct + '%')
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
